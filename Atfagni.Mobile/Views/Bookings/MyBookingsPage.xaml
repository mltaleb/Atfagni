<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Atfagni.Mobile.ViewModels.Bookings"
             xmlns:dto="clr-namespace:Atfagni.Shared.DTOs;assembly=Atfagni.Shared"
             xmlns:controls="clr-namespace:Atfagni.Mobile.Controls"
             x:DataType="vm:MyBookingsViewModel"
             x:Class="Atfagni.Mobile.Views.Bookings.MyBookingsPage"
             Title="Mes RÃ©servations">
    <Grid>
  
    <RefreshView Command="{Binding LoadBookingsCommand}" IsRefreshing="{Binding IsBusy}">
        <ScrollView Padding="20">
            <VerticalStackLayout Spacing="20">

                <Label Text="ðŸš€ Ã€ VENIR" FontAttributes="Bold" TextColor="#2196F3"/>
                <CollectionView ItemsSource="{Binding UpcomingBookings}">
                    <CollectionView.EmptyView>
                        <Label Text="Aucun voyage prÃ©vu" HorizontalOptions="Center" TextColor="Gray" Margin="0,10"/>
                    </CollectionView.EmptyView>
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="dto:BookingRequestDto">
                            <Border StrokeShape="RoundRectangle 10" Margin="0,5" Padding="15" BackgroundColor="White">
                                <Grid ColumnDefinitions="*, Auto">
                                    <VerticalStackLayout>
                                            <!-- AFFICHAGE DE LA DATE -->
                                            <Label Text="{Binding DepartureDate, StringFormat='{0:dddd d MMMM Ã  HH:mm}'}" 
                   FontSize="12" 
                   TextColor="#2196F3" 
                   FontAttributes="Bold" />
                                            <Label Text="{Binding TripDescription}" FontAttributes="Bold" TextColor="Black"/>
                                        <Label Text="{Binding PassengerName, StringFormat='Chauffeur: {0}'}" FontSize="12" TextColor="Gray"/>
                                            <!-- BOUTON APPELER : Visible uniquement si status = Accepted -->
                                            <Button Text="{Binding PassengerPhone, StringFormat='ðŸ“ž Appeler ({0})'}"
                    IsVisible="{Binding Status, Converter={StaticResource StatusToVisibleConverter}, ConverterParameter='Accepted'}"
                    Command="{Binding Source={RelativeSource AncestorType={x:Type vm:MyBookingsViewModel}}, Path=CallDriverCommand}"
                    CommandParameter="{Binding PassengerPhone}"
                    BackgroundColor="#E3F2FD" TextColor="#2196F3" 
                    HeightRequest="35" FontSize="11" CornerRadius="5" HorizontalOptions="Start"/>
                                        </VerticalStackLayout>
                                    <Label Grid.Column="1" Text="{Binding Status}" TextColor="Green" FontAttributes="Bold" VerticalOptions="Center"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <Label Text="âŒ› PASSÃ‰ES" FontAttributes="Bold" TextColor="Gray" Margin="0,10,0,0"/>
                <CollectionView ItemsSource="{Binding PastBookings}">
                        <CollectionView.EmptyView>
                            <Label Text="Aucun voyage effectuÃ©" HorizontalOptions="Center" TextColor="Gray" Margin="0,10"/>
                        </CollectionView.EmptyView>
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="dto:BookingRequestDto">
                                <Label Text="{Binding PassengerName}"/>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                </CollectionView>

            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>
        <controls:LoadingOverlay IsBusy="{Binding IsBusy}" 
                           LoadingMessage="Rechargement des bookings" />
    </Grid>
</ContentPage>